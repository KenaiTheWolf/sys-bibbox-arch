<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>sys-backend.bibboxbackend API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>sys-backend.bibboxbackend</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3

import os
import json
import yaml
import subprocess
from os.path import dirname, abspath
import traceback
import logging
import uuid
from datetime import datetime
import io
import requests
import copy

class AppController:


    &#34;&#34;&#34;
    Section: Helperfunctions
    &#34;&#34;&#34;


    def __init__(self):
        self.rootdir = dirname(dirname(abspath(__file__)))
        self.appPath = self.rootdir + &#39;/application-instance&#39;

    @staticmethod
    def createJobID():
        jobID = str(uuid.uuid1())
        dateObj = datetime.now()
        datestring = str(dateObj.year) + &#39;-&#39; + str(dateObj.month) + &#39;-&#39; + str(dateObj.day) + &#39;-&#39; + str(dateObj.microsecond)
        return jobID + datestring

    @staticmethod
    def checkExists(jobID, instanceName, install):
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        if instanceName in os.listdir(appPath):
            exists = True
        else:
            exists = False
        if install == True:
            if exists == True:
                raise Exception(&#39;The app you want to install does already exist!&#39;)
        if install == False:
            if exists == False:
                raise Exception(&#39;The app you want to use does not exist!&#39;)

    @staticmethod
    def createFolder(JobID, instanceName):
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        subprocess.Popen([&#39;mkdir&#39; , appPath + &#39;/&#39; + instanceName])
        subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/app.log&#39;])

    @staticmethod
    def setUpLog(jobID, instanceName):
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        path = appPath + &#39;/&#39; + instanceName + &#39;/&#39;
        try:
            logging.basicConfig(filename= path + &#39;app.log&#39;, filemode=&#39;a&#39;, format=&#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;, level=logging.DEBUG)
            
        except Exception:
            print(Exception)


    @staticmethod
    def setStatus(jobID, status, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Set status to &#39; + status )
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/STATUS&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output) )
        text_file = open(appPath + &#39;/&#39; + instanceName + &#39;/STATUS&#39;, &#34;w&#34;)
        text_file.write(status)
        text_file.close()

    @staticmethod
    def lock(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Ckeck if app is locked&#39; )
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        if &#39;LOCK&#39; in os.listdir(appPath + &#39;/&#39; + instanceName):
            with open(appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;) as lockfile:
                lockID = lockfile.read()
                if lockID != jobID:
                    logging.exception( jobID + &#39; - The app you want to use is currently locked! Please try again later!&#39;)
                    raise Exception(&#39;The app you want to use is currently locked! Please try again later!&#39;)

        logging.debug(jobID + &#39; - &#39; + &#39;Locking app: &#39; + instanceName )
        process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output) )
    
    @staticmethod
    def unlock(jobID, instanceName):
        logging.debug(jobID + &#39; - &#39; + &#39;Unlocking app: &#39; + instanceName )
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        process = subprocess.Popen([&#39;rm&#39; , appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output) )

    @staticmethod
    def downloadApp(jobID, instanceName,appName,version):
        logging.info(jobID + &#39; - &#39; + &#39;Downloading app: &#39; + appName + &#39;/&#39; + instanceName + &#39; V:&#39; + version)
        
        process = subprocess.Popen([&#39;git&#39;, &#39;clone&#39;,&#39;-b&#39;, version, &#39;https://github.com/bibbox/&#39; + appName + &#39;.git&#39;, &#39;application-instance/&#39; + instanceName + &#39;/repo/&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.exception(jobID + str(output) )
    
    @staticmethod
    def setInfo(jobID, instanceName,appName,version):
        logging.info(jobID + &#39; - &#39; + &#39;Set install info&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/INFO&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        text_file = open(appPath + &#39;/&#39; + instanceName + &#39;/INFO&#39;, &#34;w&#34;)
        text_file.write(jobID + &#39;\n&#39; + appName + &#39;\n&#39; + instanceName + &#39;\n&#39; + version)
        text_file.close()

    @staticmethod
    def setProxyFiles(jobID, instanceName, containerName):
        logging.info(jobID + &#39; - &#39; + &#39;Set proxy files&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        proxyPath = rootdir + &#39;/sys-proxy/&#39;
        name = instanceName + &#39;.conf&#39;
        with open(proxyPath + &#39;template.conf&#39;) as template:
            file_content = template.read()
            file_content = file_content.replace(&#34;§§INSTANCEID&#34;, instanceName)
            file_content = file_content.replace(&#34;§§CONTAINERNAME&#34;, containerName)
            template = open( proxyPath + &#39;proxyconfig/sites/&#39; + name, &#39;w+&#39;)
            template.write(file_content)
            template.close()

    @staticmethod
    def readContainername(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Read Containername&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        composefile = open(appPath + &#39;/&#39; + instanceName +&#39;/repo/docker-compose-template.yml&#39;, &#39;r&#39;).read()
        data = yaml.load(composefile)
        for k, v in data[&#34;services&#34;].items():
            if &#39;container_name&#39; in v:
                ContainerName = v.get(&#39;container_name&#39;)
                ContainerName = ContainerName.replace(&#39;§§INSTANCE&#39;, instanceName)
                try:
                    ContainerName = ContainerName.replace(&#39;-db&#39;, &#39;&#39;)
                except:
                    pass

        return ContainerName

    @staticmethod
    def writeCompose(jobID, paramList, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Write parameters to compose file&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        compose = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;r&#39;).read()
        #compose = yaml.load(compose)
        for key in paramList:
            compose = compose.replace(&#39;§§&#39; + key, paramList[key])
        compose = compose.replace(&#39;§§INSTANCE&#39;, instanceName)
        target = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;w&#39;)
        target.write(compose)
        target.close()
        
    @staticmethod
    def composeUp(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Docker compose up&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;up&#39;, &#39;-d&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;docker&#39;, &#39;exec&#39;, &#39;-it&#39;, &#39;local_nginx&#39;, &#39;service&#39;, &#39;nginx&#39;, &#39;reload&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))

    @staticmethod
    def stop(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Stopping App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;stop&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        #os.system(&#39;docker-compose -f &#39; + appPath + &#39;/docker-compose-template.yml stop &#39;)

    @staticmethod
    def start(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Starting App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;start&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        #os.system(&#39;docker-compose -f &#39; + appPath + &#39;/docker-compose-template.yml start &#39;)

    @staticmethod
    def remove(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Romoving App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        #os.system(&#39;docker-compose -f &#39; + appPath + &#39;/docker-compose-template.yml down &#39;)
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;down&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;sudo&#39;, &#39;chmod&#39; ,&#39;-f&#39;, &#39;-R&#39;, &#39;777&#39;, rootdir + &#39;/application-instance/&#39; + instanceName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;rm&#39; , &#39;-f&#39;, &#39;-R&#39;, rootdir + &#39;/application-instance/&#39; + instanceName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;rm&#39; , &#39;-f&#39;, rootdir + &#39;/sys-proxy/proxyconfig/sites/&#39; + instanceName + &#39;.conf&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))

    @staticmethod
    def status(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Reading Status of App: &#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/&#39;
        with open(appPath + &#39;STATUS&#39;) as statusfile:
            file_content = statusfile.read()
        return file_content

    @staticmethod
    def checkStatus(jobID, instanceName, statusList):
        logging.info(jobID + &#39; - &#39; + &#39;Checking if operation is possible for current state of app: &#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/&#39;
        with open(appPath + &#39;STATUS&#39;) as statusfile:
            file_content = statusfile.read()
        if file_content not in statusList:
            logging.exception(jobID + &#39; - &#39; + &#39;Current app status does not allow operation on app: &#39; + instanceName)
            raise Exception(&#39;Current app status does not allow your operation!&#39;)

    @staticmethod
    def copy(jobID, instanceName, newName):
        logging.info(jobID + &#39; - &#39; + &#39;Copy App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;sudo&#39;, &#39;cp&#39;, &#39;-r&#39;, rootdir + &#39;/application-instance/&#39; + instanceName, rootdir + &#39;/application-instance/&#39; + newName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))

    @staticmethod
    def changeCompose(jobID, paramList, instanceName, newName):
        logging.info(jobID + &#39; - &#39; + &#39;Write parameters to compose file&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        newAppPath = rootdir + &#39;/application-instance/&#39; + newName + &#39;/repo/&#39;
        compose = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;r&#39;)
        compose = yaml.load(compose)
        services = compose[&#39;services&#39;]
        for service in services:
            name = services[service][&#39;container_name&#39;]
            newContainerName = name.replace(instanceName, newName)
            services[service][&#39;container_name&#39;] = newContainerName
            try:
                name = services[service][&#39;links&#39;]
                newContainerName = name[0].replace(instanceName, newName)
                services[service][&#39;links&#39;] = [newContainerName]
            except:
                pass
            try:
                name = services[service][&#39;depends_on&#39;]
                newContainerName = name[0].replace(instanceName, newName)
                services[service][&#39;depends_on&#39;] = [newContainerName]
            except:
                pass

        composenew = copy.deepcopy(compose)
        for service in services:
            newServiceName = service.replace(instanceName, newName)           
            composenew[&#39;services&#39;][newServiceName] = composenew[&#39;services&#39;][service]
            del composenew[&#39;services&#39;][service]

        composefile = yaml.dump(composenew)
        os.system(&#39;sudo chmod -R 777 &#39; + newAppPath)
        target = open(newAppPath + &#39;docker-compose-template.yml&#39;, &#39;w&#39;)
        target.write(composefile)
        target.close()
        


        
    &#34;&#34;&#34;
    Section: Main functions
    &#34;&#34;&#34;

    @staticmethod
    def getParams(instanceName, appName, version):
        try:
            url = &#39;https://raw.githubusercontent.com/bibbox/&#39; + appName + &#39;/master/.env&#39;
        except Exception:
            raise Exception(&#39;Something went wrong during connecting to the GitHub repository. Please Check your internet connection!&#39;)
        download = requests.get(url).content
        data=download.decode(&#39;utf-8&#39;)
        params = data.split(&#39;\n&#39;)
        paramList = {}
        for line in params:
            params = line.split(&#39;=&#39;)
            param = params[0]
            if param == &#39;PORT&#39; or param == &#39;&#39; or param == &#39;INSTANCE&#39;:
                pass
            else:
                paramList[param] = []
            
        return paramList, instanceName, appName, version

    @staticmethod
    def setParams(paramList):
        #data = json.load(paramList)
        for key in paramList:
            paramList[key] = &#39;ww&#39;

        return paramList

    
    @staticmethod
    def installApp(paramList, instanceName, appName, version):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install = True)
        AppController.createFolder(jobID, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Prepare Install&#39;, instanceName)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Downloading&#39;, instanceName)
        AppController.downloadApp(jobID, instanceName,appName,version)
        AppController.setStatus(jobID, &#39;Installing&#39;, instanceName)
        AppController.setInfo(jobID, instanceName,appName,version)
        containerName = AppController.readContainername(jobID, instanceName)
        AppController.setProxyFiles(jobID, instanceName, containerName)
        AppController.writeCompose(jobID, paramList, instanceName)
        AppController.composeUp(jobID, instanceName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Running&#39;, instanceName)
    
    @staticmethod
    def stopApp(instanceName):
        statusList = [&#39;Running&#39;]
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.checkStatus(jobID, instanceName, statusList)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Stopping&#39;, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.stop(jobID, instanceName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Stopped&#39;, instanceName)

    @staticmethod
    def startApp(instanceName):
        statusList = [&#39;Stopped&#39;]
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.checkStatus(jobID, instanceName, statusList)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Starting&#39;, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.start(jobID, instanceName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Running&#39;, instanceName)

    @staticmethod
    def removeApp(instanceName):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Removing App&#39;, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.remove(jobID, instanceName)

    @staticmethod
    def getStatus(instanceName):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.setUpLog(jobID, instanceName)
        AppController.status(jobID, instanceName)

    @staticmethod
    def copyApp(instanceName, newName):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.lock(jobID, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.copy(jobID, instanceName, newName)
        AppController.setUpLog(jobID, newName)
        AppController.changeCompose(jobID, paramList, instanceName, newName)
        AppController.unlock(jobID, instanceName)
        AppController.composeUp(jobID, newName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Running&#39;, instanceName)
        

x = AppController()
paramList, instanceName, appName, version = x.getParams(&#39;testapp&#39;,&#39;app-seeddmsTNG&#39;,&#39;master&#39;)
paramList = x.setParams(paramList)

#x.installApp(paramList, instanceName, appName, version)
#status = x.getStatus(instanceName)
#x.stopApp(instanceName)
#x.startApp(instanceName)
#x.removeApp(instanceName)
x.copyApp(&#39;testapp&#39;, &#39;testappnew&#39;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="sys-backend.bibboxbackend.AppController"><code class="flex name class">
<span>class <span class="ident">AppController</span></span>
</code></dt>
<dd>
<div class="desc"><p>Section: Helperfunctions</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AppController:


    &#34;&#34;&#34;
    Section: Helperfunctions
    &#34;&#34;&#34;


    def __init__(self):
        self.rootdir = dirname(dirname(abspath(__file__)))
        self.appPath = self.rootdir + &#39;/application-instance&#39;

    @staticmethod
    def createJobID():
        jobID = str(uuid.uuid1())
        dateObj = datetime.now()
        datestring = str(dateObj.year) + &#39;-&#39; + str(dateObj.month) + &#39;-&#39; + str(dateObj.day) + &#39;-&#39; + str(dateObj.microsecond)
        return jobID + datestring

    @staticmethod
    def checkExists(jobID, instanceName, install):
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        if instanceName in os.listdir(appPath):
            exists = True
        else:
            exists = False
        if install == True:
            if exists == True:
                raise Exception(&#39;The app you want to install does already exist!&#39;)
        if install == False:
            if exists == False:
                raise Exception(&#39;The app you want to use does not exist!&#39;)

    @staticmethod
    def createFolder(JobID, instanceName):
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        subprocess.Popen([&#39;mkdir&#39; , appPath + &#39;/&#39; + instanceName])
        subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/app.log&#39;])

    @staticmethod
    def setUpLog(jobID, instanceName):
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        path = appPath + &#39;/&#39; + instanceName + &#39;/&#39;
        try:
            logging.basicConfig(filename= path + &#39;app.log&#39;, filemode=&#39;a&#39;, format=&#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;, level=logging.DEBUG)
            
        except Exception:
            print(Exception)


    @staticmethod
    def setStatus(jobID, status, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Set status to &#39; + status )
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/STATUS&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output) )
        text_file = open(appPath + &#39;/&#39; + instanceName + &#39;/STATUS&#39;, &#34;w&#34;)
        text_file.write(status)
        text_file.close()

    @staticmethod
    def lock(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Ckeck if app is locked&#39; )
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        if &#39;LOCK&#39; in os.listdir(appPath + &#39;/&#39; + instanceName):
            with open(appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;) as lockfile:
                lockID = lockfile.read()
                if lockID != jobID:
                    logging.exception( jobID + &#39; - The app you want to use is currently locked! Please try again later!&#39;)
                    raise Exception(&#39;The app you want to use is currently locked! Please try again later!&#39;)

        logging.debug(jobID + &#39; - &#39; + &#39;Locking app: &#39; + instanceName )
        process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output) )
    
    @staticmethod
    def unlock(jobID, instanceName):
        logging.debug(jobID + &#39; - &#39; + &#39;Unlocking app: &#39; + instanceName )
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        process = subprocess.Popen([&#39;rm&#39; , appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output) )

    @staticmethod
    def downloadApp(jobID, instanceName,appName,version):
        logging.info(jobID + &#39; - &#39; + &#39;Downloading app: &#39; + appName + &#39;/&#39; + instanceName + &#39; V:&#39; + version)
        
        process = subprocess.Popen([&#39;git&#39;, &#39;clone&#39;,&#39;-b&#39;, version, &#39;https://github.com/bibbox/&#39; + appName + &#39;.git&#39;, &#39;application-instance/&#39; + instanceName + &#39;/repo/&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.exception(jobID + str(output) )
    
    @staticmethod
    def setInfo(jobID, instanceName,appName,version):
        logging.info(jobID + &#39; - &#39; + &#39;Set install info&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/INFO&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        text_file = open(appPath + &#39;/&#39; + instanceName + &#39;/INFO&#39;, &#34;w&#34;)
        text_file.write(jobID + &#39;\n&#39; + appName + &#39;\n&#39; + instanceName + &#39;\n&#39; + version)
        text_file.close()

    @staticmethod
    def setProxyFiles(jobID, instanceName, containerName):
        logging.info(jobID + &#39; - &#39; + &#39;Set proxy files&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        proxyPath = rootdir + &#39;/sys-proxy/&#39;
        name = instanceName + &#39;.conf&#39;
        with open(proxyPath + &#39;template.conf&#39;) as template:
            file_content = template.read()
            file_content = file_content.replace(&#34;§§INSTANCEID&#34;, instanceName)
            file_content = file_content.replace(&#34;§§CONTAINERNAME&#34;, containerName)
            template = open( proxyPath + &#39;proxyconfig/sites/&#39; + name, &#39;w+&#39;)
            template.write(file_content)
            template.close()

    @staticmethod
    def readContainername(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Read Containername&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance&#39;
        composefile = open(appPath + &#39;/&#39; + instanceName +&#39;/repo/docker-compose-template.yml&#39;, &#39;r&#39;).read()
        data = yaml.load(composefile)
        for k, v in data[&#34;services&#34;].items():
            if &#39;container_name&#39; in v:
                ContainerName = v.get(&#39;container_name&#39;)
                ContainerName = ContainerName.replace(&#39;§§INSTANCE&#39;, instanceName)
                try:
                    ContainerName = ContainerName.replace(&#39;-db&#39;, &#39;&#39;)
                except:
                    pass

        return ContainerName

    @staticmethod
    def writeCompose(jobID, paramList, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Write parameters to compose file&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        compose = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;r&#39;).read()
        #compose = yaml.load(compose)
        for key in paramList:
            compose = compose.replace(&#39;§§&#39; + key, paramList[key])
        compose = compose.replace(&#39;§§INSTANCE&#39;, instanceName)
        target = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;w&#39;)
        target.write(compose)
        target.close()
        
    @staticmethod
    def composeUp(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Docker compose up&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;up&#39;, &#39;-d&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;docker&#39;, &#39;exec&#39;, &#39;-it&#39;, &#39;local_nginx&#39;, &#39;service&#39;, &#39;nginx&#39;, &#39;reload&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))

    @staticmethod
    def stop(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Stopping App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;stop&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        #os.system(&#39;docker-compose -f &#39; + appPath + &#39;/docker-compose-template.yml stop &#39;)

    @staticmethod
    def start(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Starting App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;start&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        #os.system(&#39;docker-compose -f &#39; + appPath + &#39;/docker-compose-template.yml start &#39;)

    @staticmethod
    def remove(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Romoving App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        #os.system(&#39;docker-compose -f &#39; + appPath + &#39;/docker-compose-template.yml down &#39;)
        process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;down&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;sudo&#39;, &#39;chmod&#39; ,&#39;-f&#39;, &#39;-R&#39;, &#39;777&#39;, rootdir + &#39;/application-instance/&#39; + instanceName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;rm&#39; , &#39;-f&#39;, &#39;-R&#39;, rootdir + &#39;/application-instance/&#39; + instanceName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))
        process = subprocess.Popen([&#39;rm&#39; , &#39;-f&#39;, rootdir + &#39;/sys-proxy/proxyconfig/sites/&#39; + instanceName + &#39;.conf&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))

    @staticmethod
    def status(jobID, instanceName):
        logging.info(jobID + &#39; - &#39; + &#39;Reading Status of App: &#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/&#39;
        with open(appPath + &#39;STATUS&#39;) as statusfile:
            file_content = statusfile.read()
        return file_content

    @staticmethod
    def checkStatus(jobID, instanceName, statusList):
        logging.info(jobID + &#39; - &#39; + &#39;Checking if operation is possible for current state of app: &#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/&#39;
        with open(appPath + &#39;STATUS&#39;) as statusfile:
            file_content = statusfile.read()
        if file_content not in statusList:
            logging.exception(jobID + &#39; - &#39; + &#39;Current app status does not allow operation on app: &#39; + instanceName)
            raise Exception(&#39;Current app status does not allow your operation!&#39;)

    @staticmethod
    def copy(jobID, instanceName, newName):
        logging.info(jobID + &#39; - &#39; + &#39;Copy App:&#39; + instanceName)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        process = subprocess.Popen([&#39;sudo&#39;, &#39;cp&#39;, &#39;-r&#39;, rootdir + &#39;/application-instance/&#39; + instanceName, rootdir + &#39;/application-instance/&#39; + newName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        output, error = process.communicate()
        if output:
            logging.debug(jobID + str(output))

    @staticmethod
    def changeCompose(jobID, paramList, instanceName, newName):
        logging.info(jobID + &#39; - &#39; + &#39;Write parameters to compose file&#39;)
        rootdir = dirname(dirname(abspath(__file__)))
        appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
        newAppPath = rootdir + &#39;/application-instance/&#39; + newName + &#39;/repo/&#39;
        compose = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;r&#39;)
        compose = yaml.load(compose)
        services = compose[&#39;services&#39;]
        for service in services:
            name = services[service][&#39;container_name&#39;]
            newContainerName = name.replace(instanceName, newName)
            services[service][&#39;container_name&#39;] = newContainerName
            try:
                name = services[service][&#39;links&#39;]
                newContainerName = name[0].replace(instanceName, newName)
                services[service][&#39;links&#39;] = [newContainerName]
            except:
                pass
            try:
                name = services[service][&#39;depends_on&#39;]
                newContainerName = name[0].replace(instanceName, newName)
                services[service][&#39;depends_on&#39;] = [newContainerName]
            except:
                pass

        composenew = copy.deepcopy(compose)
        for service in services:
            newServiceName = service.replace(instanceName, newName)           
            composenew[&#39;services&#39;][newServiceName] = composenew[&#39;services&#39;][service]
            del composenew[&#39;services&#39;][service]

        composefile = yaml.dump(composenew)
        os.system(&#39;sudo chmod -R 777 &#39; + newAppPath)
        target = open(newAppPath + &#39;docker-compose-template.yml&#39;, &#39;w&#39;)
        target.write(composefile)
        target.close()
        


        
    &#34;&#34;&#34;
    Section: Main functions
    &#34;&#34;&#34;

    @staticmethod
    def getParams(instanceName, appName, version):
        try:
            url = &#39;https://raw.githubusercontent.com/bibbox/&#39; + appName + &#39;/master/.env&#39;
        except Exception:
            raise Exception(&#39;Something went wrong during connecting to the GitHub repository. Please Check your internet connection!&#39;)
        download = requests.get(url).content
        data=download.decode(&#39;utf-8&#39;)
        params = data.split(&#39;\n&#39;)
        paramList = {}
        for line in params:
            params = line.split(&#39;=&#39;)
            param = params[0]
            if param == &#39;PORT&#39; or param == &#39;&#39; or param == &#39;INSTANCE&#39;:
                pass
            else:
                paramList[param] = []
            
        return paramList, instanceName, appName, version

    @staticmethod
    def setParams(paramList):
        #data = json.load(paramList)
        for key in paramList:
            paramList[key] = &#39;ww&#39;

        return paramList

    
    @staticmethod
    def installApp(paramList, instanceName, appName, version):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install = True)
        AppController.createFolder(jobID, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Prepare Install&#39;, instanceName)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Downloading&#39;, instanceName)
        AppController.downloadApp(jobID, instanceName,appName,version)
        AppController.setStatus(jobID, &#39;Installing&#39;, instanceName)
        AppController.setInfo(jobID, instanceName,appName,version)
        containerName = AppController.readContainername(jobID, instanceName)
        AppController.setProxyFiles(jobID, instanceName, containerName)
        AppController.writeCompose(jobID, paramList, instanceName)
        AppController.composeUp(jobID, instanceName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Running&#39;, instanceName)
    
    @staticmethod
    def stopApp(instanceName):
        statusList = [&#39;Running&#39;]
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.checkStatus(jobID, instanceName, statusList)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Stopping&#39;, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.stop(jobID, instanceName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Stopped&#39;, instanceName)

    @staticmethod
    def startApp(instanceName):
        statusList = [&#39;Stopped&#39;]
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.checkStatus(jobID, instanceName, statusList)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Starting&#39;, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.start(jobID, instanceName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Running&#39;, instanceName)

    @staticmethod
    def removeApp(instanceName):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.lock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Removing App&#39;, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.remove(jobID, instanceName)

    @staticmethod
    def getStatus(instanceName):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.setUpLog(jobID, instanceName)
        AppController.status(jobID, instanceName)

    @staticmethod
    def copyApp(instanceName, newName):
        jobID = AppController.createJobID()
        AppController.checkExists(jobID, instanceName, install=False)
        AppController.lock(jobID, instanceName)
        AppController.setUpLog(jobID, instanceName)
        AppController.copy(jobID, instanceName, newName)
        AppController.setUpLog(jobID, newName)
        AppController.changeCompose(jobID, paramList, instanceName, newName)
        AppController.unlock(jobID, instanceName)
        AppController.composeUp(jobID, newName)
        AppController.unlock(jobID, instanceName)
        AppController.setStatus(jobID, &#39;Running&#39;, instanceName)</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="sys-backend.bibboxbackend.AppController.changeCompose"><code class="name flex">
<span>def <span class="ident">changeCompose</span></span>(<span>jobID, paramList, instanceName, newName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def changeCompose(jobID, paramList, instanceName, newName):
    logging.info(jobID + &#39; - &#39; + &#39;Write parameters to compose file&#39;)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
    newAppPath = rootdir + &#39;/application-instance/&#39; + newName + &#39;/repo/&#39;
    compose = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;r&#39;)
    compose = yaml.load(compose)
    services = compose[&#39;services&#39;]
    for service in services:
        name = services[service][&#39;container_name&#39;]
        newContainerName = name.replace(instanceName, newName)
        services[service][&#39;container_name&#39;] = newContainerName
        try:
            name = services[service][&#39;links&#39;]
            newContainerName = name[0].replace(instanceName, newName)
            services[service][&#39;links&#39;] = [newContainerName]
        except:
            pass
        try:
            name = services[service][&#39;depends_on&#39;]
            newContainerName = name[0].replace(instanceName, newName)
            services[service][&#39;depends_on&#39;] = [newContainerName]
        except:
            pass

    composenew = copy.deepcopy(compose)
    for service in services:
        newServiceName = service.replace(instanceName, newName)           
        composenew[&#39;services&#39;][newServiceName] = composenew[&#39;services&#39;][service]
        del composenew[&#39;services&#39;][service]

    composefile = yaml.dump(composenew)
    os.system(&#39;sudo chmod -R 777 &#39; + newAppPath)
    target = open(newAppPath + &#39;docker-compose-template.yml&#39;, &#39;w&#39;)
    target.write(composefile)
    target.close()</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.checkExists"><code class="name flex">
<span>def <span class="ident">checkExists</span></span>(<span>jobID, instanceName, install)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def checkExists(jobID, instanceName, install):
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    if instanceName in os.listdir(appPath):
        exists = True
    else:
        exists = False
    if install == True:
        if exists == True:
            raise Exception(&#39;The app you want to install does already exist!&#39;)
    if install == False:
        if exists == False:
            raise Exception(&#39;The app you want to use does not exist!&#39;)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.checkStatus"><code class="name flex">
<span>def <span class="ident">checkStatus</span></span>(<span>jobID, instanceName, statusList)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def checkStatus(jobID, instanceName, statusList):
    logging.info(jobID + &#39; - &#39; + &#39;Checking if operation is possible for current state of app: &#39; + instanceName)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/&#39;
    with open(appPath + &#39;STATUS&#39;) as statusfile:
        file_content = statusfile.read()
    if file_content not in statusList:
        logging.exception(jobID + &#39; - &#39; + &#39;Current app status does not allow operation on app: &#39; + instanceName)
        raise Exception(&#39;Current app status does not allow your operation!&#39;)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.composeUp"><code class="name flex">
<span>def <span class="ident">composeUp</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def composeUp(jobID, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Docker compose up&#39;)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
    process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;up&#39;, &#39;-d&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))
    process = subprocess.Popen([&#39;docker&#39;, &#39;exec&#39;, &#39;-it&#39;, &#39;local_nginx&#39;, &#39;service&#39;, &#39;nginx&#39;, &#39;reload&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.copy"><code class="name flex">
<span>def <span class="ident">copy</span></span>(<span>jobID, instanceName, newName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def copy(jobID, instanceName, newName):
    logging.info(jobID + &#39; - &#39; + &#39;Copy App:&#39; + instanceName)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
    process = subprocess.Popen([&#39;sudo&#39;, &#39;cp&#39;, &#39;-r&#39;, rootdir + &#39;/application-instance/&#39; + instanceName, rootdir + &#39;/application-instance/&#39; + newName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.copyApp"><code class="name flex">
<span>def <span class="ident">copyApp</span></span>(<span>instanceName, newName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def copyApp(instanceName, newName):
    jobID = AppController.createJobID()
    AppController.checkExists(jobID, instanceName, install=False)
    AppController.lock(jobID, instanceName)
    AppController.setUpLog(jobID, instanceName)
    AppController.copy(jobID, instanceName, newName)
    AppController.setUpLog(jobID, newName)
    AppController.changeCompose(jobID, paramList, instanceName, newName)
    AppController.unlock(jobID, instanceName)
    AppController.composeUp(jobID, newName)
    AppController.unlock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Running&#39;, instanceName)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.createFolder"><code class="name flex">
<span>def <span class="ident">createFolder</span></span>(<span>JobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def createFolder(JobID, instanceName):
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    subprocess.Popen([&#39;mkdir&#39; , appPath + &#39;/&#39; + instanceName])
    subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/app.log&#39;])</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.createJobID"><code class="name flex">
<span>def <span class="ident">createJobID</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def createJobID():
    jobID = str(uuid.uuid1())
    dateObj = datetime.now()
    datestring = str(dateObj.year) + &#39;-&#39; + str(dateObj.month) + &#39;-&#39; + str(dateObj.day) + &#39;-&#39; + str(dateObj.microsecond)
    return jobID + datestring</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.downloadApp"><code class="name flex">
<span>def <span class="ident">downloadApp</span></span>(<span>jobID, instanceName, appName, version)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def downloadApp(jobID, instanceName,appName,version):
    logging.info(jobID + &#39; - &#39; + &#39;Downloading app: &#39; + appName + &#39;/&#39; + instanceName + &#39; V:&#39; + version)
    
    process = subprocess.Popen([&#39;git&#39;, &#39;clone&#39;,&#39;-b&#39;, version, &#39;https://github.com/bibbox/&#39; + appName + &#39;.git&#39;, &#39;application-instance/&#39; + instanceName + &#39;/repo/&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.exception(jobID + str(output) )</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.getParams"><code class="name flex">
<span>def <span class="ident">getParams</span></span>(<span>instanceName, appName, version)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def getParams(instanceName, appName, version):
    try:
        url = &#39;https://raw.githubusercontent.com/bibbox/&#39; + appName + &#39;/master/.env&#39;
    except Exception:
        raise Exception(&#39;Something went wrong during connecting to the GitHub repository. Please Check your internet connection!&#39;)
    download = requests.get(url).content
    data=download.decode(&#39;utf-8&#39;)
    params = data.split(&#39;\n&#39;)
    paramList = {}
    for line in params:
        params = line.split(&#39;=&#39;)
        param = params[0]
        if param == &#39;PORT&#39; or param == &#39;&#39; or param == &#39;INSTANCE&#39;:
            pass
        else:
            paramList[param] = []
        
    return paramList, instanceName, appName, version</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.getStatus"><code class="name flex">
<span>def <span class="ident">getStatus</span></span>(<span>instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def getStatus(instanceName):
    jobID = AppController.createJobID()
    AppController.checkExists(jobID, instanceName, install=False)
    AppController.setUpLog(jobID, instanceName)
    AppController.status(jobID, instanceName)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.installApp"><code class="name flex">
<span>def <span class="ident">installApp</span></span>(<span>paramList, instanceName, appName, version)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def installApp(paramList, instanceName, appName, version):
    jobID = AppController.createJobID()
    AppController.checkExists(jobID, instanceName, install = True)
    AppController.createFolder(jobID, instanceName)
    AppController.setUpLog(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Prepare Install&#39;, instanceName)
    AppController.lock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Downloading&#39;, instanceName)
    AppController.downloadApp(jobID, instanceName,appName,version)
    AppController.setStatus(jobID, &#39;Installing&#39;, instanceName)
    AppController.setInfo(jobID, instanceName,appName,version)
    containerName = AppController.readContainername(jobID, instanceName)
    AppController.setProxyFiles(jobID, instanceName, containerName)
    AppController.writeCompose(jobID, paramList, instanceName)
    AppController.composeUp(jobID, instanceName)
    AppController.unlock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Running&#39;, instanceName)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.lock"><code class="name flex">
<span>def <span class="ident">lock</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def lock(jobID, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Ckeck if app is locked&#39; )
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    if &#39;LOCK&#39; in os.listdir(appPath + &#39;/&#39; + instanceName):
        with open(appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;) as lockfile:
            lockID = lockfile.read()
            if lockID != jobID:
                logging.exception( jobID + &#39; - The app you want to use is currently locked! Please try again later!&#39;)
                raise Exception(&#39;The app you want to use is currently locked! Please try again later!&#39;)

    logging.debug(jobID + &#39; - &#39; + &#39;Locking app: &#39; + instanceName )
    process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output) )</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.readContainername"><code class="name flex">
<span>def <span class="ident">readContainername</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def readContainername(jobID, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Read Containername&#39;)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    composefile = open(appPath + &#39;/&#39; + instanceName +&#39;/repo/docker-compose-template.yml&#39;, &#39;r&#39;).read()
    data = yaml.load(composefile)
    for k, v in data[&#34;services&#34;].items():
        if &#39;container_name&#39; in v:
            ContainerName = v.get(&#39;container_name&#39;)
            ContainerName = ContainerName.replace(&#39;§§INSTANCE&#39;, instanceName)
            try:
                ContainerName = ContainerName.replace(&#39;-db&#39;, &#39;&#39;)
            except:
                pass

    return ContainerName</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.remove"><code class="name flex">
<span>def <span class="ident">remove</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def remove(jobID, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Romoving App:&#39; + instanceName)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
    #os.system(&#39;docker-compose -f &#39; + appPath + &#39;/docker-compose-template.yml down &#39;)
    process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;down&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))
    process = subprocess.Popen([&#39;sudo&#39;, &#39;chmod&#39; ,&#39;-f&#39;, &#39;-R&#39;, &#39;777&#39;, rootdir + &#39;/application-instance/&#39; + instanceName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))
    process = subprocess.Popen([&#39;rm&#39; , &#39;-f&#39;, &#39;-R&#39;, rootdir + &#39;/application-instance/&#39; + instanceName], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))
    process = subprocess.Popen([&#39;rm&#39; , &#39;-f&#39;, rootdir + &#39;/sys-proxy/proxyconfig/sites/&#39; + instanceName + &#39;.conf&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.removeApp"><code class="name flex">
<span>def <span class="ident">removeApp</span></span>(<span>instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def removeApp(instanceName):
    jobID = AppController.createJobID()
    AppController.checkExists(jobID, instanceName, install=False)
    AppController.lock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Removing App&#39;, instanceName)
    AppController.setUpLog(jobID, instanceName)
    AppController.remove(jobID, instanceName)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.setInfo"><code class="name flex">
<span>def <span class="ident">setInfo</span></span>(<span>jobID, instanceName, appName, version)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def setInfo(jobID, instanceName,appName,version):
    logging.info(jobID + &#39; - &#39; + &#39;Set install info&#39;)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/INFO&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))
    text_file = open(appPath + &#39;/&#39; + instanceName + &#39;/INFO&#39;, &#34;w&#34;)
    text_file.write(jobID + &#39;\n&#39; + appName + &#39;\n&#39; + instanceName + &#39;\n&#39; + version)
    text_file.close()</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.setParams"><code class="name flex">
<span>def <span class="ident">setParams</span></span>(<span>paramList)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def setParams(paramList):
    #data = json.load(paramList)
    for key in paramList:
        paramList[key] = &#39;ww&#39;

    return paramList</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.setProxyFiles"><code class="name flex">
<span>def <span class="ident">setProxyFiles</span></span>(<span>jobID, instanceName, containerName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def setProxyFiles(jobID, instanceName, containerName):
    logging.info(jobID + &#39; - &#39; + &#39;Set proxy files&#39;)
    rootdir = dirname(dirname(abspath(__file__)))
    proxyPath = rootdir + &#39;/sys-proxy/&#39;
    name = instanceName + &#39;.conf&#39;
    with open(proxyPath + &#39;template.conf&#39;) as template:
        file_content = template.read()
        file_content = file_content.replace(&#34;§§INSTANCEID&#34;, instanceName)
        file_content = file_content.replace(&#34;§§CONTAINERNAME&#34;, containerName)
        template = open( proxyPath + &#39;proxyconfig/sites/&#39; + name, &#39;w+&#39;)
        template.write(file_content)
        template.close()</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.setStatus"><code class="name flex">
<span>def <span class="ident">setStatus</span></span>(<span>jobID, status, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def setStatus(jobID, status, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Set status to &#39; + status )
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    process = subprocess.Popen([&#39;touch&#39; , appPath + &#39;/&#39; + instanceName + &#39;/STATUS&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output) )
    text_file = open(appPath + &#39;/&#39; + instanceName + &#39;/STATUS&#39;, &#34;w&#34;)
    text_file.write(status)
    text_file.close()</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.setUpLog"><code class="name flex">
<span>def <span class="ident">setUpLog</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def setUpLog(jobID, instanceName):
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    path = appPath + &#39;/&#39; + instanceName + &#39;/&#39;
    try:
        logging.basicConfig(filename= path + &#39;app.log&#39;, filemode=&#39;a&#39;, format=&#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;, level=logging.DEBUG)
        
    except Exception:
        print(Exception)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.start"><code class="name flex">
<span>def <span class="ident">start</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def start(jobID, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Starting App:&#39; + instanceName)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
    process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;start&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.startApp"><code class="name flex">
<span>def <span class="ident">startApp</span></span>(<span>instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def startApp(instanceName):
    statusList = [&#39;Stopped&#39;]
    jobID = AppController.createJobID()
    AppController.checkExists(jobID, instanceName, install=False)
    AppController.checkStatus(jobID, instanceName, statusList)
    AppController.lock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Starting&#39;, instanceName)
    AppController.setUpLog(jobID, instanceName)
    AppController.start(jobID, instanceName)
    AppController.unlock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Running&#39;, instanceName)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.status"><code class="name flex">
<span>def <span class="ident">status</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def status(jobID, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Reading Status of App: &#39; + instanceName)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/&#39;
    with open(appPath + &#39;STATUS&#39;) as statusfile:
        file_content = statusfile.read()
    return file_content</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.stop"><code class="name flex">
<span>def <span class="ident">stop</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def stop(jobID, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Stopping App:&#39; + instanceName)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
    process = subprocess.Popen([&#39;docker-compose&#39;, &#39;-f&#39;, appPath + &#39;/docker-compose-template.yml&#39;, &#39;stop&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output))</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.stopApp"><code class="name flex">
<span>def <span class="ident">stopApp</span></span>(<span>instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def stopApp(instanceName):
    statusList = [&#39;Running&#39;]
    jobID = AppController.createJobID()
    AppController.checkExists(jobID, instanceName, install=False)
    AppController.checkStatus(jobID, instanceName, statusList)
    AppController.lock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Stopping&#39;, instanceName)
    AppController.setUpLog(jobID, instanceName)
    AppController.stop(jobID, instanceName)
    AppController.unlock(jobID, instanceName)
    AppController.setStatus(jobID, &#39;Stopped&#39;, instanceName)</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.unlock"><code class="name flex">
<span>def <span class="ident">unlock</span></span>(<span>jobID, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def unlock(jobID, instanceName):
    logging.debug(jobID + &#39; - &#39; + &#39;Unlocking app: &#39; + instanceName )
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance&#39;
    process = subprocess.Popen([&#39;rm&#39; , appPath + &#39;/&#39; + instanceName + &#39;/LOCK&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output, error = process.communicate()
    if output:
        logging.debug(jobID + str(output) )</code></pre>
</details>
</dd>
<dt id="sys-backend.bibboxbackend.AppController.writeCompose"><code class="name flex">
<span>def <span class="ident">writeCompose</span></span>(<span>jobID, paramList, instanceName)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def writeCompose(jobID, paramList, instanceName):
    logging.info(jobID + &#39; - &#39; + &#39;Write parameters to compose file&#39;)
    rootdir = dirname(dirname(abspath(__file__)))
    appPath = rootdir + &#39;/application-instance/&#39; + instanceName + &#39;/repo/&#39;
    compose = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;r&#39;).read()
    #compose = yaml.load(compose)
    for key in paramList:
        compose = compose.replace(&#39;§§&#39; + key, paramList[key])
    compose = compose.replace(&#39;§§INSTANCE&#39;, instanceName)
    target = open(appPath + &#39;/docker-compose-template.yml&#39;, &#39;w&#39;)
    target.write(compose)
    target.close()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="sys-backend" href="index.html">sys-backend</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="sys-backend.bibboxbackend.AppController" href="#sys-backend.bibboxbackend.AppController">AppController</a></code></h4>
<ul class="two-column">
<li><code><a title="sys-backend.bibboxbackend.AppController.changeCompose" href="#sys-backend.bibboxbackend.AppController.changeCompose">changeCompose</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.checkExists" href="#sys-backend.bibboxbackend.AppController.checkExists">checkExists</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.checkStatus" href="#sys-backend.bibboxbackend.AppController.checkStatus">checkStatus</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.composeUp" href="#sys-backend.bibboxbackend.AppController.composeUp">composeUp</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.copy" href="#sys-backend.bibboxbackend.AppController.copy">copy</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.copyApp" href="#sys-backend.bibboxbackend.AppController.copyApp">copyApp</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.createFolder" href="#sys-backend.bibboxbackend.AppController.createFolder">createFolder</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.createJobID" href="#sys-backend.bibboxbackend.AppController.createJobID">createJobID</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.downloadApp" href="#sys-backend.bibboxbackend.AppController.downloadApp">downloadApp</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.getParams" href="#sys-backend.bibboxbackend.AppController.getParams">getParams</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.getStatus" href="#sys-backend.bibboxbackend.AppController.getStatus">getStatus</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.installApp" href="#sys-backend.bibboxbackend.AppController.installApp">installApp</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.lock" href="#sys-backend.bibboxbackend.AppController.lock">lock</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.readContainername" href="#sys-backend.bibboxbackend.AppController.readContainername">readContainername</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.remove" href="#sys-backend.bibboxbackend.AppController.remove">remove</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.removeApp" href="#sys-backend.bibboxbackend.AppController.removeApp">removeApp</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.setInfo" href="#sys-backend.bibboxbackend.AppController.setInfo">setInfo</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.setParams" href="#sys-backend.bibboxbackend.AppController.setParams">setParams</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.setProxyFiles" href="#sys-backend.bibboxbackend.AppController.setProxyFiles">setProxyFiles</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.setStatus" href="#sys-backend.bibboxbackend.AppController.setStatus">setStatus</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.setUpLog" href="#sys-backend.bibboxbackend.AppController.setUpLog">setUpLog</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.start" href="#sys-backend.bibboxbackend.AppController.start">start</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.startApp" href="#sys-backend.bibboxbackend.AppController.startApp">startApp</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.status" href="#sys-backend.bibboxbackend.AppController.status">status</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.stop" href="#sys-backend.bibboxbackend.AppController.stop">stop</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.stopApp" href="#sys-backend.bibboxbackend.AppController.stopApp">stopApp</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.unlock" href="#sys-backend.bibboxbackend.AppController.unlock">unlock</a></code></li>
<li><code><a title="sys-backend.bibboxbackend.AppController.writeCompose" href="#sys-backend.bibboxbackend.AppController.writeCompose">writeCompose</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>