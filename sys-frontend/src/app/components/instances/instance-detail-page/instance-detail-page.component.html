<div id="instance-details" *ngIf="instance$ | async">
  <div class="instance-details-header">
    <span class="instance-details-title">
      <img src="assets/img/b3africa.png" alt="404">
      <h1>{{instanceItem.displayname_short}}</h1>
      <h3>{{instanceItem.displayname_long}}</h3>
    </span>
    <span class="instance-details-controls" *ngIf="tabIndex == 0">
      <ng-container> <!-- *ngIf="instanceItem.state === 'STOPPED'" -->
        <span class="status stopped"></span>
        <button (click)="startInstance()">
          <svg viewBox="0 0 1000 1000">
            <path d="M451.523,528.59V47.615c0-26.233,21.267-47.5,47.5-47.5s47.5,21.267,47.5,47.5V528.59c0,26.233-21.267,47.5-47.5,47.5S451.523,554.823,451.523,528.59z M711.563,158.396c-23.034-12.554-51.885-4.056-64.438,18.98s-4.055,51.885,18.98,64.438c113.472,61.835,183.962,180.438,183.962,309.526c0,94.084-36.639,182.536-103.165,249.063c-66.527,66.527-154.979,103.166-249.063,103.166s-182.537-36.639-249.064-103.166S145.609,645.424,145.609,551.34c0-129.281,70.646-247.969,184.369-309.747c23.052-12.522,31.587-41.361,19.065-64.413c-12.522-23.052-41.362-31.586-64.413-19.065C140.281,236.53,50.609,387.206,50.609,551.34c0,60.354,11.831,118.929,35.165,174.097c22.528,53.261,54.769,101.085,95.826,142.143c41.057,41.057,88.881,73.298,142.143,95.825c55.167,23.334,113.742,35.165,174.097,35.165s118.93-11.831,174.097-35.165c53.261-22.527,101.085-54.769,142.142-95.826c41.058-41.057,73.298-88.881,95.825-142.143c23.334-55.167,35.165-113.741,35.165-174.096C945.068,387.45,855.595,236.883,711.563,158.396z"></path>
          </svg>
          <span class="text"> Start </span>
        </button>
        <button (click)="deleteInstance()">
          <svg viewBox="0 0 1000 1000">
             <path d="M451.523,528.59V47.615c0-26.233,21.267-47.5,47.5-47.5s47.5,21.267,47.5,47.5V528.59c0,26.233-21.267,47.5-47.5,47.5S451.523,554.823,451.523,528.59z M711.563,158.396c-23.034-12.554-51.885-4.056-64.438,18.98s-4.055,51.885,18.98,64.438c113.472,61.835,183.962,180.438,183.962,309.526c0,94.084-36.639,182.536-103.165,249.063c-66.527,66.527-154.979,103.166-249.063,103.166s-182.537-36.639-249.064-103.166S145.609,645.424,145.609,551.34c0-129.281,70.646-247.969,184.369-309.747c23.052-12.522,31.587-41.361,19.065-64.413c-12.522-23.052-41.362-31.586-64.413-19.065C140.281,236.53,50.609,387.206,50.609,551.34c0,60.354,11.831,118.929,35.165,174.097c22.528,53.261,54.769,101.085,95.826,142.143c41.057,41.057,88.881,73.298,142.143,95.825c55.167,23.334,113.742,35.165,174.097,35.165s118.93-11.831,174.097-35.165c53.261-22.527,101.085-54.769,142.142-95.826c41.058-41.057,73.298-88.881,95.825-142.143c23.334-55.167,35.165-113.741,35.165-174.096C945.068,387.45,855.595,236.883,711.563,158.396z"></path>
          </svg>
          <span class="text"> Delete </span>
        </button>
      </ng-container>

      <ng-container> <!-- *ngIf="instanceItem.state === 'RUNNING'" -->
        <span class="status running"></span>
        <button>
          <svg viewBox="0 0 1000 1000">
            <path d="M451.523,528.59V47.615c0-26.233,21.267-47.5,47.5-47.5s47.5,21.267,47.5,47.5V528.59c0,26.233-21.267,47.5-47.5,47.5S451.523,554.823,451.523,528.59z M711.563,158.396c-23.034-12.554-51.885-4.056-64.438,18.98s-4.055,51.885,18.98,64.438c113.472,61.835,183.962,180.438,183.962,309.526c0,94.084-36.639,182.536-103.165,249.063c-66.527,66.527-154.979,103.166-249.063,103.166s-182.537-36.639-249.064-103.166S145.609,645.424,145.609,551.34c0-129.281,70.646-247.969,184.369-309.747c23.052-12.522,31.587-41.361,19.065-64.413c-12.522-23.052-41.362-31.586-64.413-19.065C140.281,236.53,50.609,387.206,50.609,551.34c0,60.354,11.831,118.929,35.165,174.097c22.528,53.261,54.769,101.085,95.826,142.143c41.057,41.057,88.881,73.298,142.143,95.825c55.167,23.334,113.742,35.165,174.097,35.165s118.93-11.831,174.097-35.165c53.261-22.527,101.085-54.769,142.142-95.826c41.058-41.057,73.298-88.881,95.825-142.143c23.334-55.167,35.165-113.741,35.165-174.096C945.068,387.45,855.595,236.883,711.563,158.396z"></path>
          </svg>
          <span class="text"> Stop </span>
        </button>
        <button>
          <svg viewBox="0 0 1000 1000">
            <path d="M992.001,507.999c0,66.4-13.015,130.838-38.683,191.522c-24.782,58.593-60.251,111.205-105.421,156.375s-97.782,80.639-156.375,105.421C630.838,986.985,566.4,1000,500,1000s-130.838-13.015-191.523-38.683c-58.592-24.782-111.204-60.251-156.373-105.421c-45.171-45.17-80.64-97.782-105.422-156.375C21.014,638.837,7.999,574.399,7.999,507.999c0-94.006,26.612-185.405,76.962-264.315c32.16-50.405,72.985-94.28,120.361-129.74l-65.975-97.322L459.096,0L325.479,291.191l-69.749-102.89c-37.34,28.562-69.592,63.569-95.152,103.63c-41.137,64.473-62.881,139.188-62.881,216.068c0,107.459,41.848,208.486,117.832,284.471C291.514,868.455,392.541,910.302,500,910.302s208.486-41.847,284.471-117.832c75.985-75.984,117.831-177.012,117.831-284.471c0-65.419-16.042-130.34-46.392-187.744c-29.407-55.622-72.15-104.294-123.606-140.756c-20.21-14.321-24.983-42.314-10.663-62.524c14.321-20.21,42.315-24.984,62.524-10.664c62.867,44.548,115.097,104.031,151.042,172.018C972.361,348.603,992.001,428.021,992.001,507.999z"></path>
          </svg>
          <span class="text"> Restart </span>
        </button>
      </ng-container>

      <ng-container> <!-- *ngIf="instanceItem.state === 'INSTALLING'" -->
        <span class="status in_operation"></span>
        <button disabled style="background: lightgray">
          <svg viewBox="0 0 1000 1000">
            <path d="M451.523,528.59V47.615c0-26.233,21.267-47.5,47.5-47.5s47.5,21.267,47.5,47.5V528.59c0,26.233-21.267,47.5-47.5,47.5S451.523,554.823,451.523,528.59z M711.563,158.396c-23.034-12.554-51.885-4.056-64.438,18.98s-4.055,51.885,18.98,64.438c113.472,61.835,183.962,180.438,183.962,309.526c0,94.084-36.639,182.536-103.165,249.063c-66.527,66.527-154.979,103.166-249.063,103.166s-182.537-36.639-249.064-103.166S145.609,645.424,145.609,551.34c0-129.281,70.646-247.969,184.369-309.747c23.052-12.522,31.587-41.361,19.065-64.413c-12.522-23.052-41.362-31.586-64.413-19.065C140.281,236.53,50.609,387.206,50.609,551.34c0,60.354,11.831,118.929,35.165,174.097c22.528,53.261,54.769,101.085,95.826,142.143c41.057,41.057,88.881,73.298,142.143,95.825c55.167,23.334,113.742,35.165,174.097,35.165s118.93-11.831,174.097-35.165c53.261-22.527,101.085-54.769,142.142-95.826c41.058-41.057,73.298-88.881,95.825-142.143c23.334-55.167,35.165-113.741,35.165-174.096C945.068,387.45,855.595,236.883,711.563,158.396z"></path>
          </svg>
          <span class="text"> Start </span>
        </button>

      </ng-container>
    </span>
  </div>

  <mat-tab-group animationDuration="0ms" mat-align-tabs="center" [(selectedIndex)]="tabIndex" id="tab-nav">
    <mat-tab label="Dashboard">
      <ng-template matTabContent>
        <br><br><br>
        <div class="instance-details-info-primary">
          <table>
            <tbody>
            <tr>
              <td class="label-short">ID:</td>
              <td>{{instanceItem.instancename}}</td>
            </tr>
            </tbody>
          </table>
          <table>
            <tbody>
            <tr>
              <td class="label-short">App:</td>
              <td>{{instanceItem.app.name}} {{instanceItem.app.version}}</td>
            </tr>
            </tbody>
          </table>
          <table>
            <tbody>
            <tr>
              <td class="label-short">Version:</td>
              <td>{{instanceItem.app.version}}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="instance-details-info row">
          <div class="col-2">
            <div class="list-box">
              <table>
                <tbody>
                <tr *ngFor="let link of instanceLinks">
                  <td class="icon"><img src="assets/img/external_ref.png" alt="^"></td>
                  <td class="label-left">{{link.label}}</td>
                  <td>
                    <a href="{{link.url}}" target="_blank" rel="noopener noreferrer">
                      {{link.url}}
                    </a>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-2">
            <div class="list-box">
              <table>
                <tbody>
                <tr>
                  <td class="label-right">Containers:</td>
                  <td>
                    <span *ngFor="let container of instanceContainerNames"> {{container}} <br/></span>
                  </td>
                </tr>
                <tr>
                  <td class="label-right">Instance:</td>
                  <td>/opt/bibbox/instances/{{instanceItem.instancename}}</td>
                </tr>
                <tr>
                  <td class="label-right">Proxy:</td>
                  <td>/opt/bibbox/proxy/sites/005-{{instanceItem.instancename}}.conf</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <br><br><br><br>
        <div class="row">
          <div class="col-2">
            <label>Short name</label><br>
            <input type="text" class="right" [(ngModel)]="instanceItem && instanceItem.displayname_short">
          </div>
          <div class="col-2">
            <label>Long name</label><br>
            <input type="text" class="right" [(ngModel)]="instanceItem && instanceItem.displayname_long">
          </div>
        </div>
        <br><br>
        <form class="description-form">
          <mat-form-field class="description-form-field">
            <mat-label>Short Description</mat-label>
            <textarea matInput value="" placeholder="-"></textarea>
          </mat-form-field> <br/><br/>
          <mat-form-field class="description-form-field">
            <mat-label>Long Description</mat-label>
            <textarea matInput value="" placeholder="-"></textarea>
          </mat-form-field>
        </form>
        <button (click)="saveInstanceChanges()"> Save </button>
      </ng-template>
    </mat-tab>


    <mat-tab label="Logs">
      <ng-template matTabContent>
        <br><br><br>
        <!-- https://material.angular.io/components/table/examples#table-http -->
        <ng-container *ngFor="let dockerContainerName of instanceContainerNames">
          <div class="instance-details-log-item">
            <span class="instance-details-log-containername">{{dockerContainerName}}</span><br>
            <span class="instance-details-log-command">$ docker logs {{dockerContainerName}} --tail 200</span><br>
            <div class="instance-details-log-container">
              <div *ngFor="let log_entry of instanceContainerLogs[dockerContainerName]" class="instance-details-log-container-entry">{{log_entry}}</div>
            </div>
          </div>
          <br><br><br>
        </ng-container>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>
